(()=>{var P=Object.create,p=Object.defineProperty,M=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty,L=Object.getOwnPropertyNames,A=Object.getOwnPropertyDescriptor,T=a=>p(a,"__esModule",{value:!0}),V=(a,e,t)=>{if(T(a),e&&typeof e=="object"||typeof e=="function")for(let n of L(e))!F.call(a,n)&&n!=="default"&&p(a,n,{get:()=>e[n],enumerable:!(t=A(e,n))||t.enumerable});return a},N=a=>a&&a.__esModule?a:V(p(a!=null?P(M(a)):{},"default",{value:a,enumerable:!0}),a),d=N(require("@ungap/event-target")),q={broadcast:!1},j={broadcast:!1},u=class{constructor({data:e,expiresAt:t=null}){this.data=e,this.expiresAt=t}isResolving(){return this.data instanceof Promise}hasExpired(){return this.expiresAt===null||this.expiresAt<new Date}expiresIn(e){return this.expiresAt=new Date,this.expiresAt.setMilliseconds(this.expiresAt.getMilliseconds()+e),this}},v=class{constructor(){this.elements=new Map;this.event=new d.default}resolve(e,t){Promise.resolve(t.data).then(n=>{if(n==null)return this.remove(e);t.data=n,this.broadcast(e,n)})}get(e){return this.elements.get(e)}set(e,t){this.elements.set(e,t),this.resolve(e,t)}remove(e,t){let{broadcast:n}={...q,...t};n&&this.broadcast(e,void 0),this.elements.delete(e)}clear(e){let{broadcast:t}={...j,...e};if(t)for(let n of this.elements.keys())this.broadcast(n,void 0);this.elements.clear()}has(e){return this.elements.has(e)}subscribe(e,t){this.event.addEventListener(e,t)}unsubscribe(e,t){this.event.removeEventListener(e,t)}broadcast(e,t){this.event.dispatchEvent(new CustomEvent(e,{detail:t}))}};var H=a=>fetch(a).then(e=>e.json()),f={cache:new v,errors:new d.default,fetcher:H,initialData:void 0,loadInitialCache:!0,revalidateOnStart:!0,dedupingInterval:2e3,revalidateOnFocus:!0,focusThrottleInterval:5e3,revalidateOnReconnect:!0},D={...f,force:!1},R={revalidate:!0,revalidateOptions:{...D}},m={broadcast:!1};var z=class{constructor(e){this.options={...f,...e}}get cache(){return this.options.cache}get errors(){return this.options.errors}requestData(e,t){return t(e).catch(n=>{this.errors.dispatchEvent(new CustomEvent(e,{detail:n}));return})}resolveKey(e){if(typeof e=="function")try{return e()}catch{return}return e}clear(e,t){let n={...m,...t};if(e==null)return this.cache.clear(n);if(!Array.isArray(e))return this.cache.remove(e,n);for(let i of e)this.cache.remove(i,n)}revalidate(e,t){if(!e)return;let{fetcher:n,dedupingInterval:i}=this.options,{force:s,fetcher:r,dedupingInterval:c}={...D,fetcher:n,dedupingInterval:i,...t},o;(s||!this.cache.has(e)||this.cache.has(e)&&this.cache.get(e).hasExpired())&&(o=this.requestData(e,r)),o!==void 0&&this.mutate(e,new u({data:o}).expiresIn(c),{revalidate:!1})}mutate(e,t,n){if(!e)return;let{revalidate:i,revalidateOptions:s}={...R,...n},r;if(typeof t=="function"){let c=null;if(this.cache.has(e)){let o=this.cache.get(e);o.isResolving()||(c=o.data)}r=t(c)}else r=t;this.cache.set(e,r instanceof u?r:new u({data:r})),i&&this.revalidate(e,s)}subscribe(e,t){if(e){let n=({detail:i})=>t(i);return this.cache.subscribe(e,n),()=>this.cache.unsubscribe(e,n)}return()=>{}}subscribeErrors(e,t){if(e){let n=({detail:i})=>t(i);return this.errors.addEventListener(e,n),()=>this.errors.removeEventListener(e,n)}return()=>{}}subscribeVisibility(e,{throttleInterval:t=5e3,enabled:n=!0}={}){if(n&&typeof window!="undefined"){let i=null,s=()=>{let r=Date.now();(i===null||r-i>t)&&(i=r,e())};return window.addEventListener("focus",s),()=>window.removeEventListener("focus",s)}return()=>{}}subscribeNetwork(e,{enabled:t=!0}={}){return t&&typeof window!="undefined"?(window.addEventListener("online",e),()=>window.removeEventListener("online",e)):()=>{}}get(e){if(e&&this.cache.has(e)){let t=this.cache.get(e);if(!t.isResolving())return t.data}return}use(e,t,n,i){let{fetcher:s,initialData:r,loadInitialCache:c,revalidateOnStart:o,dedupingInterval:S,revalidateOnFocus:b,focusThrottleInterval:W,revalidateOnReconnect:C}={...this.options,...i},O=(l,I)=>this.mutate(this.resolveKey(e),l,I),y=l=>this.revalidate(this.resolveKey(e),l),h=()=>y({fetcher:s,dedupingInterval:S});o&&h();let E=this.subscribe(this.resolveKey(e),t),x=this.subscribeErrors(this.resolveKey(e),n),K=this.subscribeVisibility(h,{throttleInterval:W,enabled:b}),g=this.subscribeNetwork(h,{enabled:C}),w=()=>{E(),x(),K(),g()};if(r&&O(r,{revalidate:!1}),c){let l=this.get(this.resolveKey(e));l&&t(l)}return{unsubscribe:w}}};})();
/*! Copyright (c) Èrik C. Forés - MIT */
